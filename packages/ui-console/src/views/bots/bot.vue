<template>
  <div class="bot" :class="[size]">
    <div class="avatar" :style="{ backgroundImage: `url(${data.avatar})` }" @click="$emit('avatar-click')">
      <el-tooltip :content="statusNames[data.status]">
        <div :class="['status', data.status, { error: data.error }]"></div>
      </el-tooltip>
    </div>
    <div class="content">
      <div><i class="fas fa-robot"/>{{ data.username }}</div>
      <div><i class="fas fa-boxes"/>{{ data.platform }}</div>
      <div v-if="size === 'large'"><i class="fas fa-robot"/> {{ data.selfId }}</div>
      <div class="cur-frequency">
        <span style="margin-right: 8px">
          <i class="fas fa-arrow-up"/>
          <span>{{ data.currentRate[0] }}/min</span>
        </span>
        <span>
          <i class="fas fa-arrow-down"/>
          <span>{{ data.currentRate[1] }}/min</span>
        </span>
      </div>
      <div v-if="stats" class="recent-frequency">
        <span title="发送"
              style="margin-right: 5px">
          <i class="fas fa-paper-plane"/>
          {{stats.botReceive[`${data.platform}:${data.selfId}`] || 0}}/min
        </span>
        <span title="接收">
          <i class="fas fa-paper-plane"
             style="transform: rotateX(180deg)"/>
          {{stats.botSend[`${data.platform}:${data.selfId}`] || 0}}/min
        </span>
      </div>
    </div>
  </div>
</template>

<script lang="ts" setup>

import { stats } from '~/client'
import type { Bot, BotData } from '~/server'

const statusNames: Record<Bot.Status, string> = {
  online: '运行中',
  offline: '离线',
  connect: '正在连接',
  reconnect: '正在重连',
}

defineProps<{
  data: BotData,
  size?: 'large' | 'medium' | 'small'
}>()

</script>

<style scoped lang="scss">

@import '~/variables';

div.bot {
  padding: 1rem 2rem;
  width: 16rem;
  display: flex;

  @include button-like;

  &.active {
    > div.avatar {
      border: 2px solid var(--primary);
    }
  }

  > div.avatar {
    position: relative;
    width: 80px;
    height: 80px;
    box-sizing: border-box;
    border: 1px solid var(--border);
    border-radius: 100%;
    background-size: 100%;
    background-repeat: no-repeat;
    transition: 0.1s ease;

    > div.status {
      $border-width: 4px;
      position: absolute;
      bottom: -$border-width;
      right: -$border-width;
      width: 1rem;
      height: 1rem;
      border-radius: 100%;
      border: $border-width solid var(--bg0);

      &.online {
        background-color: var(--success);
      }
      &.connect, &.reconnect {
        background-color: var(--warning);
      }
      &.error {
        background-color: var(--error) !important;
      }
      &.offline {
        background-color: var(--disabled);
      }
    }
  }

  > div.content {
    flex-grow: 1;

    margin-left: 1.25rem;

    display: flex;
    flex-direction: column;
    justify-content: space-around;

    i {
      width: 20px;
      margin-right: 8px;
      text-align: center;
    }
  }

  &.large {
    padding: 10px;
    width: 600px; height: 360px;
  }
}
</style>
